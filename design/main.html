<!--
title: Design
description: Main Design Document
published: true
date: 2020-01-25T11:40:00.879Z
tags: design, class, network, physical host
-->

<h1>About</h1><p>This document covers the high level design of oxide.one.</p><h1>Hostnames</h1><p>Hostnames for all machines (physical and virtual) are typically chosen at random. They do not follow a specific pattern. Often hosts will be chosen from the NSA Ant catalogue.</p><h1>Machine Class</h1><p>The following is a table describing the classes of machines that are used within oxide.one.</p><figure class="table"><table><thead><tr><th>Class</th><th>Size</th><th>CPU (2x)</th><th>RAM (GB)</th><th>NIC</th><th>Net Speed (Gb/S)</th></tr></thead><tbody><tr><td>A1</td><td>1U</td><td>E5-2620 v1</td><td>48</td><td>MLNX X353A</td><td>40</td></tr><tr><td>B1</td><td>2U</td><td>E5-2650 v2</td><td>64</td><td>INTEL X520</td><td>10</td></tr></tbody></table></figure><h2>Class A1</h2><p>Class A1 is a 1U Server, typically installed in a Supermicro CSE-815 Chassis. The purpose of Class A1 is to provide a fair amount of compute and network power inside a small frame. A1 Class servers are used to host mission critical services, such as DNS, Routing or Kubernetes Master nodes.</p><p>A1 Servers are designed to have a high uptime, so the CPU model is kept to a relatively low spec to allow for overkill cooling, and low power draw. RAM is kept low for cost purposes.</p><p>Storage for class A1 servers are proivded by a single SSD on a Sata 3 Link. Typically the size will be 500GB. This serves for all storage.</p><p>Given it's purpose, Class A1 is provided with a Mellanox ConnectX-3, a 40Gb/s NIC. This it to allow for high performance routing.&nbsp;</p><p>Class A1 servers are installed with Fedora 31 Server.</p><h2>Class B1</h2><p>Class B1 is a 2U Server, typically installed in a Supermicro CSE-825 or CSE-827 Chassis. The purpose of Class A2 is to provide compute power and act as a general purpose hypervisor.&nbsp;</p><p>B1 Class servers are designed for performance, so their CPU model is significantly more powerful along with RAM being higher. They are used to host general purpose virtual machines, such as Kubernetes nodes. Class B1 servers have a lower priority for uptime than A1.&nbsp;</p><p>Storage for class B1 servers are provided by 2 SSDS. The first being a 250-500GB SSD on a Sata 3 Link. The second being a 500GB NVME SSD on a PCIE Link.&nbsp;</p><p>The Sata SSD provides OS level storage; whereas the NVME provides Virtual Machine and Ceph Storage.</p><p>Class B1 is fitted with an Intel X520-SR1 10Gb/s Nic. This is so that there is a fast link to the network, but not fast enough to saturate the routing link (40Gb/s)</p><p>Class B1 servers are installed with Fedora 31 Server.</p><h1>Network Design</h1><p>Within the oxide.one system, there are several networks. They are outlined as follows.</p><figure class="table"><table><thead><tr><th>Name</th><th>Subnet</th><th>CIDR</th><th>DNS</th><th>Domain</th><th>VLAN</th></tr></thead><tbody><tr><td>Outer</td><td>10.0.0.0</td><td>24</td><td>1.1.1.1</td><td>dhcp.</td><td>0</td></tr><tr><td>Server</td><td>10.0.2.0</td><td>24</td><td>DNS1</td><td>srv.</td><td>0</td></tr><tr><td>Virtual</td><td>10.0.4.0</td><td>24</td><td>DNS1</td><td>vm.</td><td>4</td></tr><tr><td>Utility</td><td>10.0.5.0</td><td>24</td><td>DNS1</td><td>nix.</td><td>5</td></tr><tr><td>Zoned</td><td>10.0.6.0</td><td>24</td><td>DNS1</td><td>zone.</td><td>6</td></tr><tr><td>Kube</td><td>10.0.7.0</td><td>24</td><td>DNS1</td><td>kube.</td><td>7</td></tr><tr><td>Wireguard</td><td>10.0.8.0</td><td>24</td><td>DNS1</td><td>wg.</td><td>8</td></tr><tr><td>Management</td><td>10.0.10.0</td><td>24</td><td>DNS1</td><td>mgmt.</td><td>10</td></tr></tbody></table></figure><p>The domain is a subdomain within .oxide.one, so the outer network would be dhcp.oxide.one. The gateway for each network exists on 10.0.x.1.&nbsp;</p><p>DNS1 is currently <strong>10.0.5.8</strong></p><h2>Networks</h2><h3>Outer</h3><p>This network is the wider network. This proivdes internet access to all other networks.</p><h3>Server</h3><p>The Server network is for physical servers only.</p><h3>Virtual</h3><p>The virtual network is designed for general purpose virtual machines that do not have any dependants.&nbsp;</p><h3>Utility</h3><p>The Utility network is designed for virtual machines that provide utlity or function and have dependants. This includes services such as NFS and DNS.&nbsp;</p><h3>Zoned</h3><p>This network is for untrusted virtual machines, such as <a href="https://information.rapid7.com/download-metasploitable-2017.html">Metasploitable</a>. They do not have access to any other networks, and have limited access to the internet.</p><h3>Kube</h3><p>The kube network is for <a href="https://kubernetes.io/">Kubernetes</a> related virtual machines. This isn't strictly Kubernetes nodes. This can also be resources that provide resources only to a kuberentes cluster (such as <a href="https://ceph.io/">ceph</a>).</p><h3>Wireguard</h3><p>The Wireguard network is for virtual machines that need access to a VPN. Any machine on this network is connected to a VPN over <a href="https://www.wireguard.com/">wireguard</a> to <a href="https://mullvad.net/en/">Mullvad.</a></p><h3>Management</h3><p>The management network is for IPMI Devices and Access point pages.&nbsp;</p><h2>DNS</h2><p>For each network; there is a subdomain associated with it. These subdomains exist within the oxide.one domain.&nbsp;</p><p>In addition to all the networks and subdomains above, there exists a subdomain for services. svc.oxide.one is to reach services within other networks. All records within svc.oxide.one is CNAME'd to another host.</p><p>One such example of this, is for NFS. The NFS server exists as midnight.nix.oxide.one, but it is exposed as a service through nfs.svc.oxide.one. This allows for abstraction away from hosts.</p><p>DNS is provided by FreeIPA (BIND9). DHCP updates are sent to FreeIPA; so that machines that used DHCP always have a correct A record behind their hostname.</p><h1>Physical Machines</h1><h2>Hydrogen (Class A1)</h2><p>Hydrogen is the 'master node' of the estate. This server runs everything mission critical to operation of the estate.</p><p>Hydrogen currently provides the&nbsp;</p><h2>Blackbird</h2><h2>Inferno</h2><h2>Phoenix</h2><h2>Halcyon</h2><h1>Virtual Machines</h1>