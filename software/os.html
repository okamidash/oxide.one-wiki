<!--
title: OS Level Setup
description: Design breif for OS Level setup of physical and virtual hosts
published: true
date: 2020-01-25T17:33:59.356Z
tags: OS, Fedora, Virtual Machine, Physical Machine
-->

<p>This section covers OS level setup for both virtual machines and physical machines. Generally I keep stuff at the OS defaults, with the following changes made.</p><h1>Operating System</h1><p>The base operating system shall be based on Fedora 31 unless there is a specific reason not to. This is to make system management easier across the estate.</p><p>Physical hosts use Fedora server.</p><p>Virtual hosts use Fedora cloud images.</p><h1>Tweaks</h1><p>The following section covers various tweaks to the base Fedora 31 operating system.</p><h2>SELINUX</h2><p>Selinux is Disabled on all hosts.</p><p>This can be done by editing the file <span style="font-family:'Courier New', Courier, monospace;"><mark class="marker-blue">/etc/selinux/config</mark> </span>and ensuring the line <span style="font-family:'Courier New', Courier, monospace;"><mark class="marker-blue">SELINUX= is SELINUX=disabled</mark></span></p><h2><span style="font-family:'Courier New', Courier, monospace;">Firewall</span></h2><p>The firewall on physical hosts is disabled. This can be done with:</p><blockquote><p>systemctl stop firewalld &amp;&amp; systemctl stop firewalld</p></blockquote><h2>Packages</h2><p>To make package management easier, all hosts shall have dnf automatic configured and installed.</p><p>Physical hosts shall have dnf-automatic configured to download only. Installing the packages is left up to the operator to do; which is completed on a weekly basis.</p><p>This is done so that bringing down a physical host (and the VMs that live on it) is planned, rather than sporadic.</p><p>Virtual hosts should have dnf-automatic configured to download and install immediately. This is done because bringing down a VM won't mean bringing down an entire stack (usually).</p><h3>Hypervisors</h3><p>Hypervisors also have the following packages installed.</p><ul><li>Virtualization (group)</li><li>Figlet</li><li>Lolcat</li><li>Cron</li><li>Freeipa-client</li><li>autoconfig</li></ul><h2>Users</h2><p>For all hosts, the root account is disabled.</p><p>The user <i>okami</i> shall exist on all systems, in the following groups:</p><ul><li>docker</li><li>wheel</li><li>libvirt</li></ul><h2>Sudo</h2><p>Users in the wheel group shall have passwordless sudo enabled. This can be achieved with the following line.</p><blockquote><p>%wheel ALL=(ALL) NOPASSWD: ALL</p></blockquote><p>The following settings shall also be set in the sudoers file.</p><blockquote><p>&nbsp;Defaults env_keep += "LANG LANGUAGE LINGUAS LC_* _XKB_CHARSET" Defaults env_keep += "HOME" Defaults env_keep += "XAPPLRESDIR XFILESEARCHPATH XUSERFILESEARCHPATH" Defaults env_keep += "QTDIR KDEDIR" Defaults env_keep += "XDG_SESSION_COOKIE"</p></blockquote><h2>SSH</h2><p>SSH is the primary method of accessing any system across the estate.</p><p>Password authentication is not allowed anywhere. This can be achieved with <span style="font-family:'Courier New', Courier, monospace;"><mark class="marker-blue">/etc/ssh/sshd_config</mark></span></p><p>&nbsp;</p><blockquote><p>PasswordAuthentication no</p></blockquote><h2>MOTD</h2><p>Physical hosts should have a MOTD setup using a script. Currently they should use the script provided by <a href="https://github.com/okamidash/motdshell">this repo</a></p><h2>CRON</h2><p>Cron is used to handle backing up of virtual machines.</p><p>Enable and start Cron with</p><blockquote><p>systemctl enable --now crond.service</p></blockquote><p>Then add the following line to <span style="font-family:'Courier New', Courier, monospace;"><mark class="marker-blue">/etc/anacrontab</mark></span></p><blockquote><p>@daily &nbsp;25 backup-machines /usr/local/bin/backupscript.sh</p></blockquote><p>Then grab the backupscript.sh file from <a href="https://github.com/okamidash/motdshell">this repo</a> and place it in <span style="font-family:'Courier New', Courier, monospace;"><mark class="marker-blue">/usr/local/bin/</mark></span></p>